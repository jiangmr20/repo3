子产品及功能配置总结

总结：首先理解一下流程，流程是activiti框架，其自带有数据表去实现流程，就是说，使用该框架的方法，即可生成流程，并且存入框架自带的表中。而我们要做的，就是将数据存入表单，或者同时存入自己建的表，去控制数据；此外，还要通过bpmn.xml文件，去配置流程的开始事件、结束事件、中间节点，连接的边路径，以及配置的监听器等（ps：流程的路径也可以通过流程自带的方法进行跳过，不一定要按xml里配置的边）。

注意权限控制

#### 1、getList

将子产品的信息存入自建的表中，getList时使用sql语句查出即可。

这里有个学习点，查询的数据需要按照拼音排序，以前是新建一个inital字段存字母开头，在java层或sql进行排序，现在有个新的在sql层查询的技巧：

```xml
select
        tsp.processId,
        tsp.typeId,
        tsp.name,
        tp.product_name productName,
        tno.name unitName,
        tsp.createTime date,
        tsp.status
        from tb_son_product tsp
        left join tb_product tp on tp.product_id = tsp.belongProductId
        left join tb_new_organization tno on tno.department_id = tsp.applyDeptId
        where 1=1
        <if test='isCheck == false'>
            and tsp.applyUser=#{userId}
        </if>
        <if test="keyword != null ">
            and tp.product_name like #{keyword}
        </if>
        <if test="sortField.equals('tsp.name') or sortField.equals('tp.product_name') or sortField.equals('tno.name')">
            order by convert(${sortField} USING gbk) ${sortOrder}
        </if>
        <if test="sortField.equals('tsp.createTime') or sortField.equals('tsp.status')">
            order by ${sortField} ${sortOrder}
        </if>
```

即使用：order by convert(${字段} USING gbk) ${asc/desc}



2、saveApply

保存草稿，思路是把数据转化为一个json字符串，当做一个长字段数据存入数据表中。如draft表，以下为一个简化的草稿表：tb_draft

| 列名        | 类型        | 含义     | 备注                     |
| ----------- | ----------- | -------- | ------------------------ |
| id          | bigint      | 主键标识 | PK(自增)                 |
| topic       | Varchar(50) | 标题     |                          |
| create_date | date        | 创建时间 |                          |
| context     | text        | 草稿内容 |                          |
| attachments | Varchar(50) | 附件ids  | 附件id之间用英文逗号隔开 |



3、submitItem

提交流程。







1、需要考虑监听器，包括修改状态的监听器，发送邮件的监听器，查看springboot监听器用法

2、

